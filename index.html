<html ng-app="custom-webapp-ui" lang="en">
  <head>
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />
    <!-- Load the Telegram Library -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      /* Add custom styles for radio buttons */
      .custom-radio-button {
        display: inline-block;
        background-color: #ccc;
        padding: 10px 20px;
        cursor: pointer;
      }
      .custom-radio-button.active {
        background-color: #007bff;
        color: #fff;
      }
    </style>
  </head>
  <body ng-controller="CustomUIController">
    <div class="container px-5 my-5">
      <form class="form-horizontal">
        <fieldset>
          <!-- Form Name -->
          <legend>Create order</legend>

          <!-- Custom Radio Buttons for Market Type -->
          <div class="form-group">
            <label class="col-md-4 control-label">Order Type</label>
            <div class="col-md-8">
              <div
                class="custom-radio-button"
                id="marketTypeMarket"
                data-market-type="MARKET"
              >
                MARKET
              </div>
              <div
                class="custom-radio-button"
                id="marketTypeLimit"
                data-market-type="LIMIT"
              >
                LIMIT
              </div>
              <div
                class="custom-radio-button"
                id="marketTypeLadder"
                data-market-type="Ladder"
              >
                Ladder
              </div>
            </div>
          </div>

          <!-- Select Basic for MARKET -->
          <div
            class="form-group market-field limit-field ladder-field"
            style="display: none"
          >
            <label class="col-md-4 control-label" for="selectbasic">
              Asset
            </label>
            <div class="col-md-4">
              <select id="assetselect" name="assetselect" class="form-control">
                <option value="BTC/USDT">BTC/USDT</option>
                <option value="ETH/USDT">ETH/USDT</option>
              </select>
            </div>
          </div>

          <div
            class="form-group market-field limit-field ladder-field"
            style="display: none"
          >
            <label class="col-md-4 control-label" for="selectlimit">
              Long/Short
            </label>
            <div class="col-md-4">
              <select
                id="longshortselect"
                name="longshortselect"
                class="form-control"
              >
                <option value="BUY">BUY</option>
                <option value="SELL">SELL</option>
              </select>
            </div>
          </div>

          <div class="form-group limit-field" style="display: none">
            <label class="col-md-4 control-label" for="LimitPrice"
              >At Price</label
            >
            <div class="col-md-4">
              <input
                id="LimitPrice"
                name="LimitPrice"
                type="number"
                placeholder="at Price"
                class="form-control input-md"
                required=""
              />
            </div>
          </div>

          <div
            class="form-group market-field limit-field ladder-field"
            style="display: none"
          >
            <label class="col-md-4 control-label" for="Amount">Amount %</label>
            <div class="col-md-4 input-group amount-group">
              <input
                id="Amount"
                name="Amount"
                type="number"
                placeholder="Amount"
                class="form-control input-md"
                required=""
              />
              <div class="input-group-append">
                <button
                  class="btn btn-secondary"
                  type="button"
                  id="amountButton5"
                  value="5"
                >
                  5%
                </button>
                <button
                  class="btn btn-secondary"
                  type="button"
                  id="amountButton10"
                  value="10"
                >
                  10%
                </button>
                <button
                  class="btn btn-secondary"
                  type="button"
                  id="amountButton15"
                  value="15"
                >
                  15%
                </button>
                <button
                  class="btn btn-secondary"
                  type="button"
                  id="amountButton25"
                  value="25"
                >
                  25%
                </button>
                <button
                  class="btn btn-secondary"
                  type="button"
                  id="amountButton50"
                  value="50"
                >
                  50%
                </button>
                <button
                  class="btn btn-secondary"
                  type="button"
                  id="amountButton100"
                  value="100"
                >
                  100%
                </button>
              </div>
            </div>
          </div>

          <div class="form-group ladder-field" style="display: none">
            <label class="col-md-4 control-label" for="StartPrice"
              >Start Price</label
            >
            <div class="col-md-4">
              <input
                id="StartPrice"
                name="StartPrice"
                type="number"
                placeholder="StartPrice"
                class="form-control input-md"
                required=""
              />
            </div>
          </div>

          <div class="form-group ladder-field" style="display: none">
            <label class="col-md-4 control-label" for="EndPrice"
              >End Price</label
            >
            <div class="col-md-4">
              <input
                id="EndPrice"
                name="EndPrice"
                type="number"
                placeholder="EndPrice"
                class="form-control input-md"
                required=""
              />
            </div>
          </div>
          <div class="form-group ladder-field" style="display: none">
            <label class="col-md-4 control-label" for="OrdersNo">
              Orders #
            </label>
            <div class="col-md-4">
              <select id="OrdersNo" name="OrdersNo" class="form-control">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
              </select>
            </div>
          </div>

          <button id="submit" name="submit" class="btn btn-primary">
            submit
          </button>
        </fieldset>
      </form>
    </div>
    <script>
      $(document).ready(function () {
        // Wait for the document to be fully loaded

        // Handle custom radio button clicks
        $(".custom-radio-button").click(function () {
          $(".custom-radio-button").removeClass("active");
          $(this).addClass("active");

          // Get the selected market type
          var selectedMarketType = $(this).data("market-type");

          // Show/hide the corresponding form fields
          $(".market-field").hide();
          $(".limit-field").hide();
          $(".ladder-field").hide();
          $("." + selectedMarketType.toLowerCase() + "-field").show();
        });

        // Initialize with MARKET selected
        $("#marketTypeMarket").trigger("click");
        const mainButton = window.Telegram.WebApp.MainButton;
        mainButton.text = "Save Preferences";
        mainButton.enable();
        mainButton.show();
        mainButton.onClick(function () {
          data_to_send = processDataToSend();
          console.log(data_to_send);
          if (data_to_send) {
            window.Telegram.WebApp.sendData(JSON.stringify(data_to_send));
          }
        });

        function processDataToSend() {
          var data_to_send = {};
          var selectedOrderType = $(".custom-radio-button.active").data(
            "market-type"
          );
          selectedOrderType = selectedOrderType.toLowerCase();
          console.log(selectedOrderType);
          if ($("#Amount").val() == "") {
            alert("Please enter amount %");
            return false;
          }
          if ($("#Amount").val() < 0 || $("#Amount").val() > 100) {
            alert("Please enter amount % between 0 to 100");
            return false;
          }

          if (selectedOrderType == "market") {
            data_to_send = {
              order_type: selectedOrderType,
              asset: $("#assetselect").val(),
              longshort: $("#longshortselect").val(),
              amount: $("#Amount").val(),
            };
          } else if (selectedOrderType == "limit") {
            data_to_send = {
              order_type: selectedOrderType,
              asset: $("#assetselect").val(),
              longshort: $("#longshortselect").val(),
              amount: $("#Amount").val(),
              limit_price: $("#LimitPrice").val(),
            };
          } else if (selectedOrderType == "ladder") {
            data_to_send = {
              order_type: selectedOrderType,
              asset: $("#assetselect").val(),
              longshort: $("#longshortselect").val(),
              amount: $("#Amount").val(),
              start_price: $("#StartPrice").val(),
              end_price: $("#EndPrice").val(),
              order_no: $("#OrderNo").val(),
            };
          } else {
            alert("Please select order type");
          }
          return data_to_send;
        }

        $("#submit").click(function (e) {
          e.preventDefault();
          data_to_send = processDataToSend();
          console.log(data_to_send);
          // This function will be executed when the Submit button is clicked
          alert("Submit button clicked!"); // You can replace this with your desired action
        });

        $(".amount-group button").click(function () {
          var buttonValue = parseInt($(this).val()); // Get the button value (e.g., 5, 10, 15, ...)
          $("#Amount").val(buttonValue);
        });
      });
    </script>
  </body>
</html>
